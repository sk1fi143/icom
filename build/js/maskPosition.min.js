function saveMaskPosition(transform) {
  localStorage.setItem('maskPosition', transform);
}
function getSavedMaskPosition() {
  return localStorage.getItem('maskPosition');
}
function getElementPosition(title) {
  const element = document.querySelector(`[data-title="${title}"]`);
  let position = '360px';

  if (element) {
    const activeWidth = element.offsetWidth;
    const maxActiveWidth = Math.max(activeWidth, 100);
    let centerActive;
    if (activeWidth > 100) {
      centerActive = element.offsetLeft - activeWidth / 3;
      position = `translateX(${centerActive - 17}px) scaleX(${maxActiveWidth / 82})`;
    } else if (activeWidth < 100) {
      centerActive = element.offsetLeft + activeWidth / 2;
      position = `translateX(${centerActive - maxActiveWidth / 2 - 32}px) scaleX(${maxActiveWidth / 100})`;
    }
  }

  return position;
}
function moveMaskToActiveElement() {
  const activeElement = document.querySelector('.header__menu-item.activeHead');
  if (activeElement) {
    const mask = document.querySelector('.mask-header');
    const activeWidth = activeElement.offsetWidth;
    const maxActiveWidth = Math.max(activeWidth, 100);
    let centerActive;
    if (activeWidth > 100) {
      centerActive = activeElement.offsetLeft - activeWidth / 3;
      mask.style.transform = `translateX(${centerActive - 17}px) scaleX(${maxActiveWidth / 82})`;
    } else if (activeWidth < 100) {
      centerActive = activeElement.offsetLeft + activeWidth / 2;
      mask.style.transform = `translateX(${centerActive - maxActiveWidth / 2 - 32}px) scaleX(${maxActiveWidth / 100})`;
    }
    saveMaskPosition(mask.style.transform);
  }
}
window.addEventListener('resize', () => {
  moveMaskToActiveElement();
  document.querySelector('.mask-header').style.transition = 'none';
});
window.addEventListener('DOMContentLoaded', () => {
  const savedMaskPosition = getSavedMaskPosition();
  if (savedMaskPosition) {
    moveMaskToActiveElement();
  } else {
    document.querySelector('.mask-header').style.transform = 'translateX(365px)';
  }
  const currentTitle = document.querySelector('html').getAttribute('data-title');
  const previousTitle = localStorage.getItem('previousTitle');
  if (currentTitle !== previousTitle) {
    localStorage.setItem('previousTitle', previousTitle);
  }
  localStorage.setItem('previousTitle', currentTitle);
});

let pos = localStorage.getItem('maskPosition');
const title = document.querySelector('html').getAttribute('data-title');
const previousTitle = localStorage.getItem('previousTitle'); // Получаем предыдущий заголовок страницы из localStorage

if (!pos) {
  if (title === 'balance' || title === 'applications' || title === 'newApp' || title === 'payments' || title === 'referal') {
    pos = getElementPosition(title);
    document.querySelector('.mask-header').style.transform = pos;
  }
  localStorage.setItem('maskPosition', pos);
} else if (previousTitle === 'settings') {
  moveMaskToActiveElement();
} else {
  document.head.innerHTML += `<style>.mask-header{
    transform: ${pos};
    transition: transform 0.4s ease-in;
  }
  #header-menu-active-visible1 {
    opacity: 0;
    transition: opacity 0.5s;}
    </style>`;
}

moveMaskToActiveElement();
